# AI 기반 무역 규제 레이더 플랫폼 요구사항 정의서 v6.1 (수정본)

**과제명**: AI 기반 무역 규제 레이더 플랫폼: ChatGPT 스타일 통합 채팅 및 실시간 SMS/이메일 알림 시스템

---

> HScode 캐시의 정확도를 올리기 위해, 테이블에 저장하기보다는 RAG를 사용하는 편이 정확도 면에서 월등할거라고 판단함. 따라서 벡터 타입을 원활하게 지원하고, AI 프로젝트에서도 많이 쓰이는 DB인 PostgreSQL로 전환함.
> 

## Ⅰ. 개요

### 1. 문서의 목적

본 문서는 "AI 기반 무역 규제 레이더 플랫폼 v6.1"의 수정된 요구사항을 정의한 문서입니다.

본 플랫폼은 **혁신적인 ChatGPT 스타일의 통합 채팅 시스템**을 통해 복잡한 무역 업무를 단일 자연어 질의로 해결하고, **Claude AI의 실시간 사고과정 표시**로 투명하고 신뢰할 수 있는 분석 결과를 제공하며, **SMS/이메일 기반 일일 알림 시스템**으로 중요한 무역 정보 변동을 정기적으로 알려주는 차세대 무역 정보 플랫폼입니다.

### 2. 핵심 혁신 사항 (v6.1 수정본)

### 🚀 **통합 채팅 시스템 고도화**

- **구조화된 AI 응답**: 핵심 정보(HSCode, 규제, 통계)와 판단 근거를 포함한 체계적인 답변을 제공하여 가독성과 신뢰성을 극대화합니다.
- **회원 전용 세션 생성**: 회원 사용자가 첫 메시지를 전송하는 시점에 채팅 세션을 생성하여 대화 기록을 영구 보존합니다.
- **비회원 휘발성 채팅**: 비회원은 세션 생성, 데이터베이스 저장 등 일체의 저장 행위 없이 실시간 채팅만 이용 가능합니다.
- **SSE 기반 동적 북마크**: 유효한 HSCode/규제/무역통계 검색 시 SSE 첫 번째 이벤트로 북마크 추가 버튼이 동적 생성됩니다.
- **단일 엔드포인트 및 즉시 스트리밍**: `POST /api/chat` 하나로 모든 채팅을 처리하며, 요청 즉시 실시간 SSE 스트리밍을 시작합니다.

### 💬 **회원 전용 채팅 기록 관리 시스템**

- **세션 기반 대화 저장**: 회원의 모든 대화 내용을 고유 세션 ID(`chat_session_uuid`)와 함께 데이터베이스에 영구적으로 저장합니다.
- **대화 기록 조회**: 대시보드에서 과거 채팅 목록을 확인하고 전체 대화 내용을 다시 볼 수 있습니다.
- **데이터 보존 정책**: HSCode 개정 주기(5년)에 맞춰 채팅 데이터를 보존하고, 주기 만료 시 안전한 절차에 따라 정리하여 법적 요구사항과 시스템 성능을 동시에 만족시킵니다.

### 🛡️ **안전하고 확장 가능한 아키텍처**

- **pg_partman 기반 테이블 파티셔닝**: 대용량 채팅 데이터를 연도별 파티션으로 자동 관리하여, 대량 데이터 삭제 시에도 서비스 영향 없이 안정적인 성능을 보장합니다.
- **JWT 기반 인증**: Access Token(30분) + Refresh Token(remember me 체크시 30일, 미체크시 1일) 정책으로 보안을 강화합니다.
- **OAuth 소셜 로그인**: Google, Kakao, Naver 통합 지원

### 🤖 **AI 기반 RAG 시스템**

- **PostgreSQL + pgvector**: 벡터 검색과 관계형 데이터베이스를 통합 관리하여 아키텍처를 단순화하고 효율성을 높입니다.
- **voyage-3-large 임베딩**: 고성능 임베딩 모델로 정확한 의미적 검색을 지원합니다.
- **명확한 근거 제시**: HSCode 분류 시 명확한 판단 근거와 유사 코드와의 차이점을 명시하여 정보의 신뢰도를 높입니다.
- **실시간 웹검색 연동**: 최신 규제 및 정보를 반영하여 답변의 정확도를 향상시킵니다.

### 3. 대상 사용자

### 주요 사용자층

- **중소기업 수출입 담당자**: 복잡한 무역 규제를 쉽게 파악하고 싶은 실무자
- **무역 업무 초보자**: HS Code 분류와 수출입 절차를 학습하고 싶은 신규 담당자
- **소규모 무역업체 운영자**: 전문 인력 없이 무역 업무를 처리해야 하는 소상공인

### 사용자 특성

- **시간 부족**: 복잡한 검색 과정 없이 즉시 답변을 원함
- **전문지식 부족**: 어려운 무역 용어와 절차를 쉽게 이해하고 싶어함
- **자동 모니터링 요구**: 변동사항을 놓치면 큰 손실로 이어질 수 있음
- **신뢰성 중시**: 잘못된 정보로 인한 리스크를 최소화하고 싶어함
- **정보 추적의 어려움**: 복잡한 검색 과정과 여러 사이트들, 수출입 물품들의 규제나 뉴스 등의 알림을 팔로우업 하기 귀찮거나 힘든 상황

### 4. 요구사항 및 문서의 범위

### 4.1 포함 범위

- **통합 채팅 시스템**: Claude AI 기반 자연어 질의 처리 및 구조화된 응답 제공 (회원: 기록 저장, 비회원: 휘발성)
- **회원 전용 채팅 기록 관리**: 세션 기반 대화 저장, 조회, 보존 정책에 따른 데이터 관리
- **SMS/이메일 통합 알림 시스템**: 휴대폰 인증부터 일일 변동사항 알림 발송까지
- **사용자 인증**: 자체/소셜 로그인 및 JWT 기반 인증 (Access Token 30분, Refresh Token 1일/30일)
- **북마크 및 모니터링**: 관심 항목 저장 및 자동 변동사항 추적
- **대시보드**: 개인화된 정보 허브(업데이트 피드, 채팅 기록, 알림 설정)
- **사이드바 기능**: 실시간 환율, 뉴스 조회 기능
- **RAG 시스템**: PostgreSQL+pgvector 기반 HSCode 지식 베이스 (voyage-3-large 임베딩)
- **데이터베이스 아키텍처**: pg_partman을 활용한 연도별 테이블 파티셔닝 적용

### 4.2 제외 범위

- **실제 무역 거래 처리**: 본 플랫폼은 정보 제공 목적으로만 사용됩니다.
- **법적 책임**: 제공된 정보의 법적 효력이나 책임은 사용자가 별도 확인해야 합니다.
- **하드웨어 인프라**: 서버, 네트워크 등 물리적 인프라 구성은 별도 문서로 다룹니다.
- **타사 API 장애**: 외부 API 서비스 중단으로 인한 문제는 제외합니다.
- **관리자 기능**: 추후 필요시 구현 예정인 최후순위 과제입니다.

### 5. 시스템 아키텍처 개요

### 5.1 혁신적 API 구조

```
┌─────────────────────────────────────────────────┐
│             Public API (인증 불필요)              │
│  ┌─────────────────────────────────────────────┐ │
│  │ POST /api/chat (통합 채팅 + 즉시 스트리밍)   │ │
│  │ - 단일 엔드포인트로 모든 처리              │ │
│  │ - 즉시 SSE 스트리밍 시작                  │ │
│  │ - 회원: 첫 메시지 시 세션 생성 + 기록 저장 │ │
│  │ - 비회원: 휘발성 채팅만, 저장 없음        │ │
│  │ - SSE로 동적 북마크 버튼 생성             │ │
│  └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────┐
│            Private API (인증 필요)               │
│  ┌─────────────┐ ┌──────────────┐ ┌────────────┐ │
│  │ JWT 인증     │ │ SMS/이메일   │ │ 북마크 관리 │ │
│  │Access 30분  │ │ 통합 알림    │ │ + 채팅기록 │ │
│  │Refresh 1일/30일│ │            │ │           │ │
│  └─────────────┘ └──────────────┘ └────────────┘ │
└─────────────────────────────────────────────────┘

```

### 5.2 핵심 기술 스택

- **AI 엔진**: Claude AI (사고과정 분석 및 웹검색)
- **실시간 통신**: Server-Sent Events (SSE) - 단일 엔드포인트 통합
- **보안**: JWT 인증 (Access Token 30분, Refresh Token 1일/30일) + HttpOnly Cookie
- **알림**: SMS/이메일 통합 API 연동
- **데이터**: PostgreSQL 15+ (pgvector 확장) + pg_partman (자동 파티셔닝) + Spring Data Redis (임시 데이터)
- **RAG 시스템**: Langchain4j 1.1.0-beta7 + PostgreSQL 15+ pgvector + voyage-3-large 임베딩

### 6. v6.1 주요 개선사항

### 6.1 비회원 채팅 정책 변경

- **완전 휘발성**: 비회원 채팅은 세션 생성, 데이터베이스 저장 등 일체의 저장 행위 없음
- **회원 전용 기록**: 채팅 기록 관리는 회원만 이용 가능
- **차별화된 서비스**: 회원가입 유도를 위한 명확한 기능 차별화

### 6.2 JWT 인증 시스템 세부화

- **Access Token**: 30분 유효, 헤더와 Zustand 상태에 저장
- **Refresh Token**: remember me 체크시 30일, 미체크시 1일, HttpOnly 쿠키에 저장
- **토큰 순환**: 보안 강화를 위한 자동 토큰 갱신

### 6.3 북마크 시스템 재설계

- **SSE 기반 동적 생성**: Claude가 유효한 검색이라고 판단하면 SSE 첫 번째 이벤트로 북마크 버튼 생성
- **컨텍스트 기반 제거**: 기존 컨텍스트 기반 북마크 시스템 완전 제거
- **즉각적 피드백**: 사용자 질의 즉시 북마크 가능 여부 표시

### 6.4 병렬 처리 구조 개선

- **3단계 병렬 처리**: (1) Claude 자연어 응답 스트리밍, (2) 상세페이지 정보 생성, (3) 회원 대화 기록 저장
- **프론트엔드 최적화**: 각 단계 완료 시점에 따라 순차적 UI 업데이트
- **로딩 상태 관리**: 상세페이지 버튼에 로딩 스피너 적용

### 6.5 pg_partman 도입

- **자동 파티션 관리**: 연도별 파티션 자동 생성 및 관리
- **운영 효율성**: 수동 관리 부담 최소화
- **확장성**: 대용량 데이터 처리 최적화

### 6.6 사이드바 기능 추가

- **실시간 환율**: 메인페이지 사이드바에서 실시간 환율 정보 조회
- **뉴스**: 무역 관련 최신 뉴스 정보 제공

---

## Ⅱ. 유스케이스

### 1. 유스케이스 다이어그램 (v6.1 수정본)

```
        ┌─────────────────────────────────────────────────────────────────┐
        │                                                                 │
        │  ┌─────────────┐              ┌─────────────────────────────┐    │
        │  │ 회원/비회원  │              │        통합 채팅 시스템      │    │
        │  │             │──────────────┤                             │    │
        │  │(모든 사용자) │              │ • 회원: 첫 메시지 시 세션 생성 │    │
        │  └─────────────┘              │ • 회원: 모든 대화 DB 파티션 저장│    │
        │         │                     │ • 비회원: 휘발성 채팅만 제공  │    │
        │         │                     │ • 구조화된 AI 답변 스트리밍  │    │
        │         │                     │ • Claude 사고과정 표시       │    │
        │         │                     │ • SSE로 동적 북마크 버튼 생성 │    │
        │         │                     └─────────────────────────────┘    │
        │         │                                                        │
        │         │ 회원가입/로그인                                        │
        │         ▼                                                        │
        │  ┌─────────────┐              ┌─────────────────────────────┐    │
        │  │    회원     │──────────────┤     JWT 기반 인증 시스템     │    │
        │  │(로그인 사용자)│              │                             │    │
        │  └─────────────┘              │ • 자체 회원가입/로그인       │    │
        │         │                     │ • OAuth 소셜 로그인         │    │
        │         │                     │ • Access Token (30분)      │    │
        │         │                     │ • Refresh Token (1일/30일)  │    │
        │         │                     └─────────────────────────────┘    │
        │         │                                                        │
        │         │                     ┌─────────────────────────────┐    │
        │         ├─────────────────────┤ SMS/이메일 통합 알림 시스템   │    │
        │         │                     │                             │    │
        │         │                     │ • 휴대폰 인증 및 번호 등록   │    │
        │         │                     │ • 기존 북마크 알림 자동 활성화│    │
        │         │                     │ • 일일 변동사항 통합 알림    │    │
        │         │                     └─────────────────────────────┘    │
        │         │                                                        │
        │         │                     ┌─────────────────────────────┐    │
        │         ├─────────────────────┤      북마크 및 모니터링      │    │
        │         │                     │                             │    │
        │         │                     │ • SSE 이벤트 기반 북마크 추가│    │
        │         │                     │ • 북마크 관리 (CRUD)        │    │
        │         │                     │ • 개별 알림 ON/OFF 설정     │    │
        │         │                     │ • 자동 모니터링 수행        │    │
        │         │                     │ • 변동사항 감지             │    │
        │         │                     └─────────────────────────────┘    │
        │         │                                                        │
        │         │                     ┌─────────────────────────────┐    │
        │         ├─────────────────────┤     회원 전용 채팅 기록      │    │
        │         │                     │                             │    │
        │         │                     │ • 과거 채팅 세션 목록 조회   │    │
        │         │                     │ • 전체 대화 내용 다시 보기   │    │
        │         │                     └─────────────────────────────┘    │
        │         │                                                        │
        │         │                     ┌─────────────────────────────┐    │
        │         ├─────────────────────┤         대시보드            │    │
        │         │                     │                             │    │
        │         │                     │ • 업데이트 피드 조회         │    │
        │         │                     │ • 채팅 기록 목록 표시        │    │
        │         │                     │ • 통합 알림 설정 관리        │    │
        │         │                     │ • 요약 정보 표시            │    │
        │         │                     └─────────────────────────────┘    │
        │         │                                                        │
        │         │                     ┌─────────────────────────────┐    │
        │         └─────────────────────┤        사이드바 기능         │    │
        │                               │                             │    │
        │                               │ • 실시간 환율 조회           │    │
        │                               │ • 무역 뉴스 조회            │    │
        │                               └─────────────────────────────┘    │
        │                                                                  │
        │  ┌─────────────┐              ┌─────────────────────────────┐    │
        │  │   시스템     │──────────────┤      자동화 프로세스         │    │
        │  │             │              │                             │    │
        │  │(스케줄러)    │              │ • 일일 모니터링 실행         │    │
        │  └─────────────┘              │ • 변동사항 자동 감지         │    │
        │                               │ • 알림 자동 발송            │    │
        │                               │ • 5년 주기 데이터 정리       │    │
        │                               │ • pg_partman 자동 관리      │    │
        │                               └─────────────────────────────┘    │
        │                                                                  │
        │  ┌─────────────┐              ┌─────────────────────────────┐    │
        │  │   AI 시스템  │──────────────┤      RAG 기반 지식베이스     │    │
        │  │             │              │                             │    │
        │  │(Claude AI)   │              │ • HSCode 벡터 검색          │    │
        │  └─────────────┘              │ • voyage-3-large 임베딩     │    │
        │                               │ • 정확한 분류 및 근거 제시   │    │
        │                               │ • 웹검색 시 명확한 차이점 저장│    │
        │                               │ • 실시간 웹검색 연동        │    │
        │                               └─────────────────────────────┘    │
        └─────────────────────────────────────────────────────────────────┘

```

### 2. 주요 액터 정의

| 액터            | 설명                                       | 접근 권한                                                                                                                               |
| --------------- | ------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------- |
| **회원/비회원** | 서비스를 이용하는 모든 사용자              | • 통합 채팅 시스템 사용 가능 (회원: 기록 저장, 비회원: 휘발성)<br>• 회원가입/로그인 접근 가능<br>• 사이드바 기능 (환율, 뉴스) 이용 가능 |
| **회원**        | 회원가입을 완료하고 로그인한 인증된 사용자 | • 모든 개인화 기능 사용 가능<br>• 북마크, 알림, 대시보드, 채팅 기록 이용 가능<br>• JWT 토큰 기반 인증 (Access 30분, Refresh 1일/30일)   |
| **시스템**      | 자동화된 백그라운드 프로세스               | • 모니터링 및 알림 자동 처리<br>• pg_partman 기반 데이터 정리 및 유지보수 작업                                                          |
| **AI 시스템**   | Claude AI 기반 지능형 처리                 | • 자연어 질의 분석 및 응답<br>• RAG 기반 지식베이스 관리<br>• voyage-3-large 임베딩 활용                                                |

### 3. 유스케이스 명세

### 3.1 통합 채팅 요청 및 회원 전용 기록 저장 (UC_CHAT_001 - v6.1 수정)

| 유스케이스 이름   | **통합 채팅 요청 및 회원 전용 기록 저장**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ----------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **유스케이스 ID** | UC_CHAT_001                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **관련 요구사항** | FR-CHAT-001, FR-CHAT-002, FR-CHAT-003, FR-CHAT-009, FR-CHAT-010, FR-CHAT-011                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **우선순위**      | **최상**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **선행조건**      | 없음 (회원/비회원 모두 사용 가능)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **관련 액터**     | 회원/비회원, AI 시스템                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **이벤트 흐름**   | **1.** 사용자가 새 대화창에서 첫 질문을 입력하여 서버에 전송합니다.<br>**2.** **[v6.1 수정]** 시스템은 사용자 인증 상태를 확인합니다:<br>   - **회원**: 새 `chat_session_uuid`를 생성하여 `chat_sessions` 테이블의 해당 연도 파티션에 세션 정보를 기록<br>   - **비회원**: 세션 생성 없이 바로 채팅 처리<br>**3.** 시스템은 즉시 SSE 스트리밍을 시작하고, 3단계 병렬 처리를 수행합니다:<br>   - **작업 A**: Claude 자연어 응답 생성 및 실시간 스트리밍<br>   - **작업 B**: HSCode/규제/무역통계 상세페이지 정보 준비<br>   - **작업 C**: 회원인 경우만 대화 기록 저장<br>**4.** **[v6.1 수정]** Claude가 유효한 검색(HSCode/규제/무역통계)이라고 판단하면, SSE 첫 번째 이벤트로 북마크 추가 버튼을 동적으로 생성합니다.<br>**5.** **[회원만]** 시스템은 사용자의 질문과 AI의 최종 응답을 `chat_messages` 테이블의 해당 연도 파티션에 저장합니다.<br>**6.** 후속 메시지들은 회원의 경우 동일한 세션 UUID를 사용하여 연속된 대화로 관리됩니다. |
| **예외 흐름**     | **E1.** 무역과 관련 없는 질문: "무역 관련 질문에만 답변할 수 있습니다"<br>**E2.** 메시지가 너무 짧음: "메시지는 2자 이상이어야 합니다"<br>**E3.** Claude AI 분석 실패: "AI 분석 중 오류가 발생했습니다"<br>**E4.** **[회원만]** 데이터베이스 저장 실패: 채팅은 정상 진행되지만 기록 저장 오류 로그 기록                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **종료조건**      | 성공: 완전한 자연어 응답, SSE 기반 동적 북마크 버튼(해당시), 회원 대화 기록 저장 완료(해당시)<br>실패: 적절한 오류 메시지 표시                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |

### 3.2 JWT 기반 인증 시스템 (UC_AUTH_001 - v6.1 세부화)

| 유스케이스 이름    | **JWT 기반 인증 시스템**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| ------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **유스케이스 ID**  | UC_AUTH_001                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **관련 요구사항**  | FR-AUTH-001, FR-AUTH-002, FR-AUTH-003                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **우선순위**       | **최상**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **선행조건**       | 없음                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **관련 액터**      | 회원/비회원                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **이벤트 흐름**    | **1.** 사용자가 로그인 페이지에서 로그인 정보와 remember me 체크박스를 선택합니다.<br>**2.** 시스템은 사용자 정보를 검증합니다.<br>**3.** **[v6.1 세부화]** 검증 성공 시 다음과 같이 토큰을 생성합니다:<br>   - **Access Token**: 30분 유효<br>   - **Refresh Token**: remember me 체크시 30일, 미체크시 1일 유효<br>**4.** **[v6.1 세부화]** 토큰 저장 방식:<br>   - **Access Token**: JSON 응답으로 반환하여 헤더와 Zustand 상태에 저장<br>   - **Refresh Token**: HttpOnly, Secure 쿠키로 설정<br>**5.** 클라이언트는 Access Token을 Zustand 상태에 저장하고 메인 페이지로 이동합니다. |
| **후속 요청 흐름** | **6.** 보호된 API 요청 시 클라이언트는 `Authorization: Bearer <access_token>` 헤더를 포함하여 요청합니다.<br>**7.** Access Token 만료(30분) 시 시스템은 401 Unauthorized를 반환합니다.<br>**8.** 클라이언트는 자동으로 `/auth/refresh` 엔드포인트를 호출하여 새로운 Access Token을 받습니다.<br>**9.** Refresh Token이 HttpOnly 쿠키로 자동 전송되어 토큰 갱신이 처리됩니다.                                                                                                                                                                                                              |
| **예외 흐름**      | **E1.** 잘못된 인증 정보: "이메일 또는 비밀번호가 올바르지 않습니다"<br>**E2.** 계정 잠김: "현재 계정에 일시적인 접근 제한이 적용되었습니다"<br>**E3.** Refresh Token 만료: 클라이언트를 로그인 페이지로 리디렉션<br>**E4.** CORS 오류: 허용된 도메인에서만 토큰 요청 가능                                                                                                                                                                                                                                                                                                                |
| **종료조건**       | 성공: Access Token을 통한 인증 완료 후 메인 페이지 이동<br>실패: 로그인 페이지에서 오류 메시지 표시<br>토큰 갱신: 새로운 Access Token 발급 후 원래 요청 재시도                                                                                                                                                                                                                                                                                                                                                                                                                            |

### 3.3 SSE 기반 동적 북마크 추가 (UC_BOOKMARK_001 - v6.1 재설계)

| 유스케이스 이름   | **SSE 기반 동적 북마크 추가**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| ----------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **유스케이스 ID** | UC_BOOKMARK_001                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **관련 요구사항** | FR-BOOKMARK-001, FR-BOOKMARK-002, FR-MONITOR-001, FR-CHAT-011                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **우선순위**      | **최상**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **선행조건**      | 회원 로그인 완료                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **관련 액터**     | 회원                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **이벤트 흐름**   | **[SSE 기반 북마크 버튼 생성]**<br>**1.** **[v6.1 재설계]** 회원이 채팅에서 자연어 질의를 입력합니다.<br>**2.** Claude AI가 해당 질의를 유효한 검색(HSCode/규제/무역통계)이라고 판단합니다.<br>**3.** 시스템은 SSE 첫 번째 이벤트를 통해 채팅 섹션 옆에 북마크 추가 버튼들을 동적으로 생성합니다.<br>**4.** 회원이 생성된 북마크 버튼을 클릭합니다.<br>**5.** 시스템은 해당 HSCode 정보를 즉시 북마크로 추가하고 자동 모니터링 대상에 등록합니다.<br><br>**[북마크 관리]**<br>**1.** 회원이 대시보드에서 북마크 목록을 조회합니다.<br>**2.** 북마크별로 표시명 수정, SMS/이메일 알림 설정, 삭제 등을 수행할 수 있습니다.<br>**3.** **[알림 설정 규칙]** SMS/이메일 알림이 모두 OFF인 북마크는 모니터링 대상에서 제외됩니다.<br>**4.** 알림 설정이 하나라도 ON인 북마크는 모니터링 대상에 포함됩니다. |
| **예외 흐름**     | **E1.** 중복 북마크: "이미 존재하는 북마크입니다"<br>**E2.** 한도 초과: "북마크 개수 한도를 초과했습니다"<br>**E3.** 휴대폰 미인증 시 SMS 설정: "SMS 알림은 휴대폰 인증 후 가능합니다"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **종료조건**      | 성공: 북마크 생성/수정/삭제 완료 및 모니터링 상태 업데이트<br>실패: 적절한 오류 메시지 표시                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

### 3.4 회원 전용 채팅 기록 조회 (UC_HISTORY_001 - v6.1 명확화)

| 유스케이스 이름   | **회원 전용 채팅 기록 조회**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **유스케이스 ID** | UC_HISTORY_001                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **관련 요구사항** | FR-HISTORY-001, FR-HISTORY-002                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **우선순위**      | **최상**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **선행조건**      | 회원 로그인 완료                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **관련 액터**     | 회원                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **이벤트 흐름**   | **[채팅 기록 목록 조회]**<br>**1.** 회원이 대시보드에서 '채팅 기록' 섹션에 접근합니다.<br>**2.** **[v6.1 명확화]** 시스템은 해당 회원의 과거 채팅 세션 목록을 pg_partman이 관리하는 연도별 파티션에서 최신순으로 조회하여 표시합니다.<br>**3.** 각 세션은 첫 번째 질문의 일부와 생성 시간을 표시합니다.<br><br>**[과거 대화 내용 조회]**<br>**1.** 회원이 특정 채팅 세션을 클릭합니다.<br>**2.** 시스템은 해당 세션의 모든 메시지를 시간순으로 조회합니다.<br>**3.** 사용자 질문과 AI 응답을 구분하여 대화 형태로 표시합니다.<br>**4.** 필요시 해당 대화에서 언급된 HSCode 정보를 다시 북마크할 수 있습니다. |
| **예외 흐름**     | **E1.** 세션 정보 없음: "조회할 수 있는 채팅 기록이 없습니다"<br>**E2.** 세션 접근 권한 없음: "해당 채팅 기록에 접근할 권한이 없습니다"<br>**E3.** 데이터 손상: "채팅 기록을 불러올 수 없습니다"                                                                                                                                                                                                                                                                                                                                                                                                             |
| **종료조건**      | 성공: 채팅 기록 목록 또는 특정 대화 내용 표시 완료<br>실패: 적절한 오류 메시지 표시                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

### 3.5 사이드바 기능 이용 (UC_SIDEBAR_001 - v6.1 신규)

| 유스케이스 이름   | **사이드바 기능 이용**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **유스케이스 ID** | UC_SIDEBAR_001                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **관련 요구사항** | FR-SIDEBAR-001, FR-SIDEBAR-002                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **우선순위**      | **최상**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **선행조건**      | 없음 (회원/비회원 모두 사용 가능)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **관련 액터**     | 회원/비회원                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **이벤트 흐름**   | **[실시간 환율 조회]**<br>**1.** **[v6.1 신규]** 사용자가 메인페이지 사이드바에서 "실시간 환율" 버튼을 클릭합니다.<br>**2.** 시스템은 외부 환율 API를 호출하여 최신 환율 정보를 조회합니다.<br>**3.** 주요 통화별 환율 정보를 사이드바 영역에 표시합니다.<br><br>**[뉴스 조회]**<br>**1.** **[v6.1 신규]** 사용자가 메인페이지 사이드바에서 "뉴스" 버튼을 클릭합니다.<br>**2.** 시스템은 무역 관련 최신 뉴스를 외부 뉴스 API를 통해 조회합니다.<br>**3.** 무역, 관세, 수출입 관련 주요 뉴스 목록을 사이드바 영역에 표시합니다. |
| **예외 흐름**     | **E1.** 외부 API 연결 실패: "현재 정보를 불러올 수 없습니다. 잠시 후 다시 시도해주세요"<br>**E2.** 데이터 파싱 오류: "정보 처리 중 오류가 발생했습니다"                                                                                                                                                                                                                                                                                                                                                                        |
| **종료조건**      | 성공: 실시간 환율 또는 뉴스 정보 표시 완료<br>실패: 적절한 오류 메시지 표시                                                                                                                                                                                                                                                                                                                                                                                                                                                    |

---

## Ⅲ. 기능 요구사항

### 1. 통합 채팅 시스템 (v6.1 수정본)

| ID              | 요구사항명칭                  | 설명                                                                                                                                                                                                | 우선순위 | 관련 API         | 관련 테이블              |
| --------------- | ----------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- | ---------------- | ------------------------ |
| **FR-CHAT-001** | **회원/비회원 차별화 채팅**   | **[v6.1 수정]** 회원: 첫 메시지 전송 시 고유 세션 UUID를 발급하고 세션을 시작하여 모든 대화를 데이터베이스에 저장. 비회원: 세션 생성, 데이터베이스 저장 등 일체의 저장 행위 없이 휘발성 채팅만 제공 | **최상** | `POST /api/chat` | `chat_sessions` (회원만) |
| **FR-CHAT-002** | **Claude 기반 의도 분석**     | 입력된 질문이 HS Code 분석, 화물 추적, 일반 무역 정보 중 어느 범주에 해당하는지 Claude AI가 자동으로 판별하고, 우선순위에 따라 상세페이지 버튼 순서를 결정하는 기능                                 | **최상** | `POST /api/chat` | -                        |
| **FR-CHAT-003** | **무역 외 질의 차단**         | 무역과 관련 없는 질문에 대해서는 적절한 안내 메시지를 제공하고 처리를 거부하는 기능                                                                                                                 | **최상** | `POST /api/chat` | -                        |
| **FR-CHAT-004** | **즉시 실시간 SSE 스트리밍**  | 단일 엔드포인트에서 요청 즉시 Server-Sent Events를 통해 Claude AI의 분석 과정과 최종 답변을 실시간으로 스트리밍하는 기능                                                                            | **최상** | `POST /api/chat` | -                        |
| **FR-CHAT-005** | **Thinking 과정 투명화**      | Claude AI의 사고과정을 단계별로 실시간 표시하여 사용자가 AI의 분석 과정을 투명하게 확인할 수 있는 기능                                                                                              | **최상** | `POST /api/chat` | -                        |
| **FR-CHAT-006** | **3단계 병렬 처리 시스템**    | **[v6.1 수정]** (1) Claude 자연어 응답 생성 및 스트리밍, (2) HSCode/규제/무역통계 상세페이지 정보 준비, (3) 회원 대화 기록 저장을 병렬로 처리하여 전체 응답 시간을 단축하는 기능                    | **최상** | `POST /api/chat` | -                        |
| **FR-CHAT-007** | **상세페이지 버튼 생성**      | 사용자 의도에 맞는 상세페이지(HSCode/규제/무역통계) 이동 버튼을 우선순위에 따라 정렬하여 제공하는 기능. 버튼 준비 전까지는 로딩 스피너 표시                                                         | **최상** | `POST /api/chat` | -                        |
| **FR-CHAT-008** | **RAG 기반 정확도 향상**      | PostgreSQL+pgvector 벡터 데이터베이스와 voyage-3-large 임베딩을 활용하여 HSCode 분류의 정확도를 향상시키고 명확한 근거를 제시하는 기능                                                              | **최상** | `POST /api/chat` | `hscode_vectors`         |
| **FR-CHAT-009** | **회원 전용 채팅 기록 저장**  | **[v6.1 수정]** 회원 사용자의 모든 대화 내용을 `chat_session_uuid`와 함께 pg_partman이 관리하는 연도별 파티션에 저장하는 기능. 비회원은 저장하지 않음                                               | **최상** | `POST /api/chat` | `chat_messages` (파티션) |
| **FR-CHAT-010** | **구조화된 AI 응답 제공**     | AI의 답변을 핵심 정보(HSCode, 규제, 통계)와 판단 근거가 명확히 구분된 형식으로 제공하는 기능                                                                                                        | **최상** | `POST /api/chat` | -                        |
| **FR-CHAT-011** | **SSE 기반 동적 북마크 버튼** | **[v6.1 재설계]** Claude가 유효한 검색(HSCode/규제/무역통계)이라고 판단하면 SSE 첫 번째 이벤트를 통해 채팅 섹션 옆에 북마크 추가 버튼을 동적으로 생성하는 기능                                      | **최상** | `POST /api/chat` | -                        |

### 2. 회원 전용 채팅 기록 관리 (v6.1 수정본)

| ID                 | 요구사항명칭                      | 설명                                                                                                                                 | 우선순위 | 관련 API                            | 관련 테이블                      |
| ------------------ | --------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------ | -------- | ----------------------------------- | -------------------------------- |
| **FR-HISTORY-001** | **회원 전용 채팅 기록 목록 조회** | **[v6.1 수정]** 대시보드에서 회원 사용자의 과거 채팅 세션 목록을 pg_partman이 관리하는 연도별 파티션에서 시간 순서대로 조회하는 기능 | **최상** | `GET /api/chat/history`             | `chat_sessions` (파티션)         |
| **FR-HISTORY-002** | **회원 전용 과거 대화 내용 조회** | **[v6.1 수정]** 회원이 특정 채팅 세션을 선택하여 전체 대화 내용을 조회하는 기능                                                      | **최상** | `GET /api/chat/history/{sessionId}` | `chat_messages` (파티션)         |
| **FR-HISTORY-003** | **회원 전용 채팅 기록 검색**      | **[v6.1 수정]** 회원이 키워드나 날짜 범위를 기준으로 과거 채팅 기록을 검색하는 기능                                                  | **상**   | `GET /api/chat/history/search`      | `chat_sessions`, `chat_messages` |

### 3. SMS/이메일 통합 알림 시스템 (v6.1 유지)

| ID                      | 요구사항명칭                             | 설명                                                                                                                         | 우선순위 | 관련 API                                | 관련 테이블                     |
| ----------------------- | ---------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------- | -------- | --------------------------------------- | ------------------------------- |
| **FR-NOTIFICATION-001** | **휴대폰 인증 코드 발송**                | 사용자가 입력한 휴대폰 번호로 6자리 인증코드를 SMS로 발송하고, 5분 만료 시간과 2분 쿨다운을 적용하는 기능                    | **최상** | `POST /api/notification/phone/send`     | Redis Hash, `notification_logs` |
| **FR-NOTIFICATION-002** | **휴대폰 인증 코드 확인**                | 발송된 6자리 인증코드를 검증하여 휴대폰 번호 인증을 완료하는 기능 (최대 5회 시도 제한)                                       | **최상** | `POST /api/notification/phone/verify`   | Redis Hash                      |
| **FR-NOTIFICATION-003** | **휴대폰 번호 등록 및 자동 알림 활성화** | 인증된 휴대폰 번호를 사용자 계정에 등록하고 SMS/이메일 알림 기능을 활성화하며, 기존 북마크의 알림을 자동으로 활성화하는 기능 | **최상** | `POST /api/notification/phone/register` | `users`, `bookmarks`            |
| **FR-NOTIFICATION-004** | **통합 알림 설정 관리**                  | 대시보드에서 SMS/이메일 알림의 전체 ON/OFF, 북마크별 알림 설정, 알림 타입별 설정을 통합 관리하는 기능                        | **최상** | `GET/PUT /api/notification/settings`    | `user_settings`, `bookmarks`    |
| **FR-NOTIFICATION-005** | **일일 변동사항 통합 알림 발송**         | 북마크한 HS Code나 화물의 변동사항을 하루마다 SMS와 이메일로 동시 발송하는 기능                                              | **최상** | 시스템 자동 처리                        | `notification_logs`             |
| **FR-NOTIFICATION-006** | **알림 내역 시스템 관리**                | 시스템 내부 모니터링을 위한 모든 SMS/이메일 발송 내역과 상태를 기록하고 관리하는 기능                                        | **상**   | 시스템 자동 처리                        | `notification_logs`             |
| **FR-NOTIFICATION-007** | **알림 발송 한도 관리**                  | 과도한 SMS/이메일 발송을 방지하기 위한 일일/시간당 발송 한도 및 쿨다운 시간 관리 기능                                        | **상**   | 시스템 자동 처리                        | Redis Hash                      |
| **FR-NOTIFICATION-008** | **개별 북마크 알림 설정 관리**           | 북마크 관리 페이지에서 각 북마크별로 SMS/이메일 알림을 개별적으로 ON/OFF 할 수 있는 기능                                     | **최상** | `PUT /api/bookmarks/{id}/notifications` | `bookmarks`                     |
| **FR-NOTIFICATION-009** | **알림 설정 연동 모니터링 관리**         | 알림 설정이 모두 OFF인 북마크는 모니터링 대상에서 제외하고, 하나라도 ON인 북마크는 모니터링 대상에 포함하는 기능             | **최상** | 시스템 자동 처리                        | `bookmarks`                     |

### 4. 사용자 인증 시스템 (v6.1 세부화)

| ID              | 요구사항명칭                | 설명                                                                                                                                   | 우선순위 | 관련 API                                          | 관련 테이블             |
| --------------- | --------------------------- | -------------------------------------------------------------------------------------------------------------------------------------- | -------- | ------------------------------------------------- | ----------------------- |
| **FR-AUTH-001** | **자체 회원가입 및 로그인** | 이메일과 비밀번호를 사용한 전통적인 회원가입 및 로그인 기능                                                                            | **최상** | `POST /api/auth/register`, `POST /api/auth/login` | `users`                 |
| **FR-AUTH-002** | **OAuth 소셜 로그인**       | Google, Kakao, Naver OAuth를 통한 간편 회원가입 및 로그인 기능 (프로필 이미지 자동 연동 포함)                                          | **최상** | `GET /api/oauth2/authorization/{provider}`        | `users`, `sns_accounts` |
| **FR-AUTH-003** | **JWT 인증 시스템**         | **[v6.1 세부화]** JWT Access Token(30분)과 Refresh Token(remember me 체크시 30일, 미체크시 1일)을 활용한 인증 및 자동 토큰 갱신 시스템 | **최상** | 시스템 전체                                       | `users`                 |
| **FR-AUTH-004** | **Token 저장 정책**         | **[v6.1 신규]** Access Token은 헤더와 Zustand 상태에 저장, Refresh Token은 HttpOnly 쿠키에 저장하는 보안 정책                          | **최상** | `POST /api/auth/refresh`                          | `users`                 |
| **FR-AUTH-005** | **인증 상태 확인**          | 현재 로그인 상태와 사용자 정보를 확인하는 기능                                                                                         | **상**   | `GET /api/auth/verify`                            | `users`                 |
| **FR-AUTH-006** | **로그아웃 처리**           | 안전한 로그아웃 및 토큰 무효화 처리                                                                                                    | **상**   | `POST /api/auth/logout`                           | -                       |
| **FR-AUTH-007** | **회원 정보 수정**          | 사용자 이름, 비밀번호 등 기본 정보 수정 기능                                                                                           | **상**   | 별도 구현 필요                                    | `users`                 |
| **FR-AUTH-008** | **계정 연동 관리**          | 하나의 이메일로 여러 SNS 계정을 연동하여 관리하는 기능                                                                                 | **중**   | OAuth 통합 처리                                   | `sns_accounts`          |

### 5. 보안 시스템 (v6.1 수정본)

| ID                  | 요구사항명칭               | 설명                                                                                                       | 우선순위 | 관련 API                 | 관련 테이블 |
| ------------------- | -------------------------- | ---------------------------------------------------------------------------------------------------------- | -------- | ------------------------ | ----------- |
| **FR-SECURITY-001** | **JWT 토큰 보안**          | **[v6.1 수정]** JWT 토큰의 안전한 생성, 검증, 만료 처리(Access 30분, Refresh 1일/30일) 및 비밀키 관리 기능 | **최상** | 시스템 전체              | -           |
| **FR-SECURITY-002** | **Refresh Token Rotation** | 보안 강화를 위한 Refresh Token 자동 갱신 및 기존 토큰 무효화 처리                                          | **상**   | `POST /api/auth/refresh` | `users`     |
| **FR-SECURITY-003** | **Rate Limiting**          | API별로 적절한 요청 빈도 제한을 적용하여 DDoS 공격을 방지하는 기능                                         | **상**   | 모든 API                 | -           |
| **FR-SECURITY-004** | **개인정보 암호화**        | 휴대폰 번호 등 민감한 개인정보의 AES-256 암호화 저장                                                       | **상**   | 시스템 전체              | `users`     |
| **FR-SECURITY-005** | **휴대폰 번호 보안 처리**  | API 응답 시 휴대폰 번호의 적절한 보안 처리 (필요시 마스킹)                                                 | **상**   | 알림 관련 API            | -           |

### 6. 북마크 및 모니터링 시스템 (v6.1 수정본)

| ID                  | 요구사항명칭              | 설명                                                                                                     | 우선순위 | 관련 API                             | 관련 테이블                 |
| ------------------- | ------------------------- | -------------------------------------------------------------------------------------------------------- | -------- | ------------------------------------ | --------------------------- |
| **FR-BOOKMARK-001** | **북마크 CRUD 관리**      | HS Code나 화물 정보를 북마크로 추가, 조회, 수정, 삭제하는 기능                                           | **최상** | `GET/POST/PUT/DELETE /api/bookmarks` | `bookmarks`                 |
| **FR-BOOKMARK-002** | **북마크 개인화 설정**    | 북마크별 표시명, 설명, SMS/이메일 알림 설정을 개별 관리하는 기능                                         | **최상** | `POST/PUT /api/bookmarks`            | `bookmarks`                 |
| **FR-BOOKMARK-003** | **북마크 자동 ID 관리**   | 각 북마크에 대해 PostgreSQL IDENTITY 컬럼을 사용하여 관리하는 기능                                       | **상**   | 북마크 API                           | `bookmarks`                 |
| **FR-BOOKMARK-004** | **SSE 기반 북마크 추가**  | **[v6.1 재설계]** SSE 이벤트를 통해 동적으로 생성된 북마크 버튼으로 HSCode 정보를 북마크에 추가하는 기능 | **최상** | `POST /api/bookmarks/from-chat`      | `bookmarks`                 |
| **FR-MONITOR-001**  | **자동 모니터링 시스템**  | 알림 설정이 활성화된 북마크에 대해 일일 변동사항을 자동 감지하는 기능                                    | **최상** | 스케줄러 자동 처리                   | `bookmarks`, `update_feeds` |
| **FR-MONITOR-002**  | **변동사항 감지 및 알림** | HS Code 관세율 변경, 규제 업데이트, 화물 상태 변경 등을 감지하고 SMS/이메일로 알림을 발송하는 기능       | **최상** | 시스템 자동 처리                     | `update_feeds`              |
| **FR-MONITOR-003**  | **모니터링 상태 관리**    | 북마크의 알림 설정 상태에 따라 모니터링 대상 포함/제외를 자동 관리하는 기능                              | **최상** | 시스템 자동 처리                     | `bookmarks`                 |

### 7. 대시보드 및 피드 시스템 (v6.1 수정본)

| ID                   | 요구사항명칭                          | 설명                                                                                                | 우선순위 | 관련 API                                                                      | 관련 테이블                |
| -------------------- | ------------------------------------- | --------------------------------------------------------------------------------------------------- | -------- | ----------------------------------------------------------------------------- | -------------------------- |
| **FR-DASHBOARD-001** | **개인화 대시보드**                   | 사용자별 북마크, 업데이트 피드, 채팅 기록, 통합 알림 설정을 관리하는 개인화된 대시보드 기능         | **최상** | `GET /api/dashboard/summary`                                                  | `v_user_dashboard_summary` |
| **FR-DASHBOARD-002** | **업데이트 피드 조회**                | 북마크한 항목들의 변동사항을 시간순으로 정렬된 피드 형태로 제공하는 기능                            | **최상** | `GET /api/dashboard/feeds`                                                    | `update_feeds`             |
| **FR-DASHBOARD-003** | **피드 읽음 처리**                    | 개별 피드나 전체 피드를 읽음 상태로 표시하여 새로운 정보를 구분하는 기능                            | **상**   | `PUT /api/dashboard/feeds/{feedId}/read`, `PUT /api/dashboard/feeds/read-all` | `update_feeds`             |
| **FR-DASHBOARD-004** | **요약 통계 정보**                    | 총 북마크 수, 읽지 않은 피드 수, 채팅 세션 수, 알림 설정 현황 등 주요 지표를 요약하여 제공하는 기능 | **상**   | `GET /api/dashboard/summary`                                                  | 여러 테이블 조인           |
| **FR-DASHBOARD-005** | **통합 알림 설정 관리**               | 대시보드에서 SMS/이메일 알림을 통합 관리하는 기능                                                   | **최상** | `GET/PUT /api/notification/settings`                                          | `user_settings`            |
| **FR-DASHBOARD-006** | **피드 요약 정보**                    | 각 피드에 대해 변동사항 요약 정보를 제공하는 기능 (상세 비교 기능 제외)                             | **상**   | `GET /api/dashboard/feeds`                                                    | `update_feeds`             |
| **FR-DASHBOARD-007** | **회원 전용 채팅 기록 대시보드 통합** | **[v6.1 수정]** 대시보드에서 회원의 최근 채팅 기록 목록을 표시하고 빠른 접근을 제공하는 기능        | **최상** | `GET /api/dashboard/recent-chats`                                             | `chat_sessions`            |

### 8. 사이드바 기능 (v6.1 신규)

| ID                 | 요구사항명칭         | 설명                                                                                                     | 우선순위 | 관련 API                          | 관련 테이블 |
| ------------------ | -------------------- | -------------------------------------------------------------------------------------------------------- | -------- | --------------------------------- | ----------- |
| **FR-SIDEBAR-001** | **실시간 환율 조회** | **[v6.1 신규]** 메인페이지 사이드바에서 실시간 환율 정보를 조회하는 기능 (회원/비회원 모두 이용 가능)    | **최상** | `GET /api/sidebar/exchange-rates` | -           |
| **FR-SIDEBAR-002** | **무역 뉴스 조회**   | **[v6.1 신규]** 메인페이지 사이드바에서 무역 관련 최신 뉴스를 조회하는 기능 (회원/비회원 모두 이용 가능) | **최상** | `GET /api/sidebar/news`           | -           |

### 9. RAG 시스템 (v6.1 개선)

| ID             | 요구사항명칭                | 설명                                                                                                                                                   | 우선순위 | 관련 API         | 관련 테이블      |
| -------------- | --------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ | -------- | ---------------- | ---------------- |
| **FR-RAG-001** | **HSCode 벡터 저장소**      | **[v6.1 개선]** PostgreSQL+pgvector와 voyage-3-large 임베딩을 활용한 HSCode 정보의 벡터 저장 및 검색 기능                                              | **최상** | `POST /api/chat` | `hscode_vectors` |
| **FR-RAG-002** | **의미적 검색 기능**        | **[v6.1 개선]** voyage-3-large 임베딩 기반 자연어 질의에 대해 의미적으로 유사한 HSCode 정보를 검색하는 기능                                            | **최상** | `POST /api/chat` | `hscode_vectors` |
| **FR-RAG-003** | **정확한 분류 근거 제시**   | HSCode 분류 시 명확한 근거와 유사 코드와의 차이점을 제시하는 기능                                                                                      | **최상** | `POST /api/chat` | `hscode_vectors` |
| **FR-RAG-004** | **웹검색 기반 정확도 향상** | **[v6.1 개선]** Claude가 HSCode를 알아내기 위해 웹검색 수행 시, 정확한 HSCode라고 판단한 명확한 근거와 유사 HSCode와의 차이점을 명시하여 저장하는 기능 | **상**   | `POST /api/chat` | `hscode_vectors` |
| **FR-RAG-005** | **지식 베이스 품질 관리**   | 저장된 HSCode 정보의 품질을 유지하고 중복을 방지하는 기능                                                                                              | **상**   | 시스템 자동 처리 | `hscode_vectors` |

### 10. 시스템 관리 및 데이터 정리 (v6.1 개선)

| ID                | 요구사항명칭                      | 설명                                                                                                                                                                       | 우선순위 | 관련 API           | 관련 테이블                      |
| ----------------- | --------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- | ------------------ | -------------------------------- |
| **FR-SYSTEM-001** | **pg_partman 기반 데이터 정리**   | **[v6.1 개선]** pg_partman을 활용한 자동 파티션 관리와 만료된 인증 세션, 임시 데이터 및 보존 기한이 지난 채팅 기록 파티션을 주기적으로 정리하는 기능                       | **중**   | 스케줄러 자동 처리 | 여러 테이블                      |
| **FR-SYSTEM-002** | **외부 API 연동 관리**            | 관세청, UN COMTRADE, 환율, 뉴스 API 등 외부 API와의 안정적인 연동 및 오류 처리                                                                                             | **상**   | 시스템 전체        | -                                |
| **FR-SYSTEM-003** | **Redis 임시 데이터 관리**        | 인증 세션, 캐시 데이터 등 Redis 임시 데이터의 생명주기 관리                                                                                                                | **상**   | 시스템 자동 처리   | Redis Hash                       |
| **FR-SYSTEM-004** | **회원 전용 채팅 기록 보존 정책** | **[v6.1 수정]** 시스템은 회원의 모든 채팅 기록을 HSCode 개정 주기(5년)에 맞춰 보존해야 하며, 데이터 정리는 개정 연도(예: 2027, 2032) 초에 이전 주기 전체를 대상으로 수행됨 | **최상** | 시스템 자동 처리   | `chat_sessions`, `chat_messages` |
| **FR-SYSTEM-005** | **데이터 삭제 사전 알림**         | 시스템은 데이터 정리 작업 예정일 30일, 7일, 1일 전에 모든 활성 사용자에게 이메일과 서비스 내 공지를 통해 관련 내용을 명확히 전달해야 함                                    | **최상** | 시스템 자동 처리   | `notification_logs`              |
| **FR-SYSTEM-006** | **모니터링 로그 관리**            | Claude API 사용량 추적을 위한 모니터링 로그 기록 및 관리 (후순위 구현)                                                                                                     | **하**   | 시스템 자동 처리   | `monitor_logs`                   |